# Проектная работа "Веб-ларек"

## Описание проекта

Проект интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

**Стек:** HTML, SCSS, TS, Webpack

## Функциональные требования

Эти требования описывают принцип работы интернет-магазина. Учитывайте их в своём проекте.

### 1. Главная страница:
- содержит каталог товаров;
- при нажатии на карточку товара открывается модальное окно с детальной информацией о товаре;
- при нажатии на иконку корзины открывается корзина.

### 2. Просмотр товара:
- показана детальная информация о товаре;
- при нажатии на кнопку «Купить» товар добавляется в корзину, если не был добавлен в корзину раньше;
- при нажатии на кнопку «Убрать» товар удаляется из корзины.

### 3. Оформление товара:

**Первый шаг:**
- выбор способа оплаты;
- ввод адреса доставки;
- если адрес доставки не введён, появляется сообщение об ошибке.

**Второй шаг:**
- ввод почты и телефона покупателя;
- если одно из полей не заполнено, появляется сообщение об ошибке;
- при нажатии на кнопку оплаты появляется сообщение об успешной оплате и товары удаляются из корзины.

### Требования ко всем страницам:
Модальные окна закрываются:
- по клику вне модального окна;
- по клику на иконку «Закрыть» (крестик).

Кнопка перехода к следующему шагу становится доступна только после выполнения действий на текущей странице (выбора товара, способа оплаты, заполнения данных о покупателе).

## Структура проекта

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

**Важные файлы:**
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Архитектура: MVP (Model-View-Presenter) с брокером событий (EventEmitter) для связи между слоями.

### Принципы архитектуры:
- **Изолированность** — отдельные части системы могут использоваться как самостоятельные решения
- **Единственная ответственность** — каждый компонент архитектуры решает ровно одну задачу и делает её хорошо
- **Масштабируемость** — возможность расширять функциональность системы без изменения базового кода

### Слои архитектуры:
- **Model** — управление данными и бизнес-логикой
- **View** — отображение интерфейса пользователя
- **Presenter** — координация между Model и View через брокер событий

### Из каких основных частей состоит архитектура проекта:

1. **Данные (Model):**
   - Product — модель товара
   - ProductList — коллекция товаров
   - Basket — корзина покупок
   - UserData — данные пользователя
   - OrderForm — форма заказа

2. **Отображения (View):**
   - ProductCard — карточка товара
   - ProductModal — модальное окно товара
   - BasketModal — модальное окно корзины
   - OrderForm — форма заказа
   - OrderSuccess — страница успешного заказа

3. **Координаторы (Presenter):**
   - ProductPresenter — управление отображением товаров
   - BasketPresenter — управление корзиной
   - OrderPresenter — управление процессом заказа

4. **Брокер событий (EventEmitter):**
   - Обеспечивает связь между компонентами через события
   - Позволяет компонентам взаимодействовать без прямых зависимостей

### Как части взаимодействуют:
- Presenter получает данные от Model
- Presenter обновляет View
- View отправляет события через EventEmitter
- Presenter обрабатывает события и обновляет Model
- Model уведомляет об изменениях через события

### Какие данные используются в приложении:
- **Товары (Product):** id, image, category, title, description, price
- **Корзина (Basket):** список товаров, общая стоимость
- **Пользователь (UserData):** адрес доставки, email, телефон
- **Заказ (OrderForm):** данные пользователя + способ оплаты + стоимость

### Из каких компонентов состоит приложение:
- **ProductCard** — отображает карточку товара в каталоге
- **ProductModal** — показывает детальную информацию о товаре
- **BasketModal** — отображает корзину покупок
- **OrderForm** — форма оформления заказа с двумя шагами
- **OrderSuccess** — страница успешного заказа
- **Modal** — базовый компонент для модальных окон
- **Button** — переиспользуемая кнопка
- **Form** — базовый компонент формы

## Описание компонентов

### Компонент ProductCard
Компонент ProductCard отображает карточку товара в каталоге, используя компонент Button для кнопки "Купить". При клике на карточку открывается модальное окно с детальной информацией о товаре.

### Компонент ProductModal
Компонент ProductModal отображает детальную информацию о товаре в модальном окне, используя базовый компонент Modal. Содержит кнопки "Купить" и "Убрать" для управления корзиной.

### Компонент BasketModal
Компонент BasketModal отображает корзину покупок в модальном окне, используя базовый компонент Modal. Показывает список товаров, общую стоимость и кнопку перехода к оформлению заказа.

### Компонент OrderForm
Компонент OrderForm управляет процессом оформления заказа с двумя шагами, используя базовый компонент Form. На первом шаге собирает способ оплаты и адрес доставки, на втором — контактные данные покупателя.

### Компонент OrderSuccess
Компонент OrderSuccess отображает страницу успешного заказа с информацией о стоимости и номером заказа.

### Компонент Modal
Компонент Modal обеспечивает базовую функциональность модальных окон. Его функции: открытие и закрытие окна, обработка кликов вне окна, управление фокусом.

### Компонент Button
Компонент Button обеспечивает отображение кнопок в интерфейсе. Его функции: настройка внешнего вида, обработка кликов, управление состоянием (активна/неактивна).

### Компонент Form
Компонент Form обеспечивает базовую функциональность форм. Его функции: валидация полей, сбор данных, отображение ошибок.

## Описание типов и классов

### Базовые типы

Для стоимости товара есть отдельный тип `Price`, который может быть `number` или `null`
(если цена товара отсутствует, например: бесценно):

``` TypeScript
type TPrice = number | null;
```

Тип для способа оплаты `PaymentMethod`, который может принимать два значения:
- `online` - оплата онлайн
- `upon_receipt` - оплата при получении

``` TypeScript
type TPaymentMethod = 'online' | 'upon_receipt';
```

Тип для HTTP-метода запроса `TApiMethod`, который может принимать следующие значения:
- `GET` — получить данные
- `POST` — создать данные
- `PUT` — полностью обновить данные
- `PATCH` — частично обновить данные
- `DELETE` — удалить данные

``` TypeScript
type TApiMethod = 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';
```

### Перечисление событий

Перечисление `Events` содержит все основные события, которые используются для взаимодействия между компонентами приложения через EventEmitter:

```TypeScript
enum Events {
  PRODUCTS_LOADED = 'products:loaded',                // Товары загружены
  PRODUCT_SELECTED = 'product:selected',              // Товар выбран

  PRODUCT_ADDED_TO_BASKET = 'product:added_to_basket',// Товар добавлен в корзину
  PRODUCT_REMOVED_FROM_BASKET = 'product:removed_from_basket', // Товар удалён из корзины

  BASKET_OPENED = 'basket:opened',                    // Корзина открыта
  BASKET_UPDATED = 'basket:updated',                  // Корзина обновлена
  BASKET_CLOSED = 'basket:closed',                    // Корзина закрыта

  ORDER_STEP_COMPLETED = 'order:step_completed',      // Шаг оформления заказа завершён
  ORDER_SUBMITTED = 'order:submitted',                // Заказ отправлен
  ORDER_SUCCESS = 'order:success',                    // Заказ успешно оформлен
  ORDER_ERROR = 'order:error',                        // Ошибка при оформлении заказа

  MODAL_OPENED = 'modal:opened',                      // Модальное окно открыто
  MODAL_CLOSED = 'modal:closed'                       // Модальное окно закрыто
}
```

**Назначение:**  
Это перечисление используется для стандартизации событий, которые могут возникать в приложении, чтобы компоненты могли реагировать на них через брокер событий (EventEmitter).  
Каждое событие — это строковая константа, которую удобно использовать для подписки и публикации событий между слоями приложения.

### Базовые классы

Класс `Product` это сам товар:

``` TypeScript
class Product {
  // Идентификатор товара
  id: string;

  // Ссылка на картинку товара
  image: string;

  // Категория товара
  category: string;

  // Наименование товара
  title: string;

  // Описание товара
  description: string;

  // Стоимость товара
  price: TPrice;
}
```

Класс `ProductList` это список товаров на странице:

``` TypeScript
class ProductList {
  // Массив со списком товаров
  products: IProduct[];

  // Устанавливает список товаров после загрузки из API
  // Принимает: items — массив товаров для установки
  // Возвращает: void
  setItems(items: IProduct[]): void;
}
```

Класс `Basket` является корзиной с товарами:

``` TypeScript
class Basket {
  // Индекс товара в корзине (1, 2, 3...)
  index: number;

  // Массив с товарами в корзине
  products: IProduct[];

  // Общая стоимость товаров
  totalPrice: TPrice;

  // Добавляет товар в корзину
  // Принимает: product — товар для добавления в корзину
  // Возвращает: void
  addItem(product: IProduct): void;

  // Удаляет товар из корзины по идентификатору
  // Принимает: id — уникальный идентификатор товара для удаления
  // Возвращает: void
  removeItem(id: string): void;

  // Очищает корзину от всех товаров
  // Возвращает: void
  clear(): void;

  // Вычисляет общую стоимость товаров в корзине
  // Возвращает: TPrice — общая стоимость всех товаров в корзине (number или null)
  calculateTotalPrice(): TPrice;

  // Получает товар по идентификатору
  // Принимает: id — уникальный идентификатор товара
  // Возвращает: IProduct | undefined — найденный товар или undefined, если товар не найден
  getItemById(id: string): IProduct | undefined;

  // Проверяет, есть ли товар в корзине
  // Принимает: id — уникальный идентификатор товара для проверки
  // Возвращает: boolean — true, если товар найден в корзине, false — если нет
  contains(id: string): boolean;
}
```

Класс `OrderForm` представляет форму заказа:

``` TypeScript
class OrderForm {
  // Способ оплаты (онлайн или при получении)
  payment: TPaymentMethod;

  // Адрес доставки
  deliveryAddress: string;

  // Email покупателя
  email: string;

  // Телефон покупателя
  phone: string;

  // Общая стоимость заказа
  totalPrice: TPrice;

  // Устанавливает способ оплаты
  // Принимает: method — способ оплаты ('online' или 'upon_receipt')
  // Возвращает: void
  setPayment(method: TPaymentMethod): void;

  // Устанавливает адрес доставки
  // Принимает: address — строка с адресом доставки
  // Возвращает: void
  setDeliveryAddress(address: string): void;

  // Устанавливает email покупателя
  // Принимает: email — строка с email адресом
  // Возвращает: void
  setEmail(email: string): void;

  // Устанавливает телефон покупателя
  // Принимает: phone — строка с номером телефона
  // Возвращает: void
  setPhone(phone: string): void;

  // Устанавливает общую стоимость заказа
  // Принимает: price — стоимость заказа (number или null)
  // Возвращает: void
  setTotalPrice(price: TPrice): void;

  // Проверяет валидность всей формы заказа
  // Возвращает: boolean — true, если все поля формы валидны, false — если есть ошибки
  validate(): boolean;

  // Метод для валидации текущего шага формы
  // Возвращает: boolean (true, если текущий шаг формы валиден, false - если есть ошибки)
  validateStep(): boolean;

  // Метод для валидации конкретного поля формы
  // Принимает: field — название поля для валидации
  // Возвращает: boolean (true, если поле валидно, false - если есть ошибки)
  validateField(field: keyof IOrderForm): boolean;

  // Метод для получения сообщения об ошибке валидации
  // Возвращает: string | null (строка с ошибкой, если есть; null — если ошибок нет)
  getValidationError(): string | null;

  // Показать сообщение об ошибке
  // Принимает: message — текст ошибки
  // Возвращает: void
  showError(message: string): void;

  // Скрыть сообщение об ошибке
  // Возвращает: void
  hideError(): void;

  // Получает данные формы в виде объекта
  // Возвращает: IOrderForm — объект с данными формы заказа
  getData(): IOrderForm;

  // Очищает форму заказа, сбрасывая все поля в начальное состояние
  // Возвращает: void
  clear(): void;
}
```

Класс `ApiResponse` представляет универсальный клиент для работы с API:

```TypeScript
class ApiResponse<T> {
  // Базовый URL для всех запросов к API
  baseUrl: string;

  // Выполняет GET-запрос по указанному URI
  // Принимает: uri — строка с адресом запроса, method — HTTP-метод (по умолчанию 'GET')
  // Возвращает: Promise<T> — промис с результатом запроса
  get<T>(uri: string, method?: TApiMethod): Promise<T>;

  // Выполняет POST-запрос по указанному URI с передачей данных
  // Принимает: uri — строка с адресом запроса, data — объект с данными, method — HTTP-метод (по умолчанию 'POST')
  // Возвращает: Promise<T> — промис с результатом запроса
  post<T>(uri: string, data: object, method?: TApiMethod): Promise<T>;
}
```

Класс `View` — базовый класс для всех представлений (View):

```TypeScript
class View {
  // Отображает данные во View
  render(data?: unknown): void;

  // Показывает View
  show(): void;

  // Скрывает View
  hide(): void;
}
```

Класс `ProductView` — представление для каталога товаров:

```TypeScript
class ProductView extends View {
  // Устанавливает обработчик выбора товара
  onProductSelect(callback: (id: string) => void): void;
}
```

Класс `BasketView` — представление для корзины:

```TypeScript
class BasketView extends View {
  // Устанавливает обработчик удаления товара из корзины
  onRemoveItem(callback: (id: string) => void): void;

  // Устанавливает обработчик перехода к оформлению заказа
  onCheckout(callback: () => void): void;
}
```

Класс `OrderFormView` — представление для формы заказа:

```TypeScript
class OrderFormView extends View {
  // Устанавливает обработчик отправки формы заказа
  onSubmit(callback: (data: IOrderForm) => void): void;
}
```

Класс `Presenter` — базовый класс для всех презентеров:

```TypeScript
class Presenter {
  // Инициализация презентера
  init(): void;

  // Уничтожение презентера
  destroy(): void;
}
```

Класс `ProductPresenter` — презентер для каталога товаров:

```TypeScript
class ProductPresenter extends Presenter {}
```

Класс `BasketPresenter` — презентер для корзины:

```TypeScript
class BasketPresenter extends Presenter {}
```

Класс `OrderPresenter` — презентер для оформления заказа:

```TypeScript
class OrderPresenter extends Presenter {}
```

Класс `EventEmitter` — брокер событий для взаимодействия между компонентами:

```TypeScript
class EventEmitter {
  // Подписка на событие
  on(event: string, listener: (...args: unknown[]) => void): void;

  // Отписка от события
  off(event: string, listener: (...args: unknown[]) => void): void;

  // Вызов события
  emit(event: string, ...args: unknown[]): void;
}
```