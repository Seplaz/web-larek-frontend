# Проектная работа "Веб-ларёк"

## Используемый стек

- **HTML** — разметка страниц
- **SCSS** — стилизация интерфейса
- **TypeScript** — типизация и логика приложения
- **Webpack** — сборка проекта

---

# Структура проекта

- src/ — исходные файлы проекта
- src/components/ — папка с компонентами
- src/components/base/ — папка с базовым кодом

# Важные файлы

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

---

## Инструкция по сборке и запуску

1. Установите зависимости:
   ```
   npm install
   ```
   или
   ```
   yarn
   ```
2. Запустите проект в режиме разработки:
   ```
   npm run start
   ```
   или
   ```
   yarn start
   ```
3. Для сборки production-версии:
   ```
   npm run build
   ```
   или
   ```
   yarn build
   ```

---

## Архитектура проекта

### 1. Основные части архитектуры

Архитектура приложения построена по паттерну **MVP (Model-View-Presenter)** с событийно-ориентированным взаимодействием через брокер событий (EventEmitter). Это обеспечивает изолированность, единую ответственность и масштабируемость компонентов.

#### Основные слои:
- **Model (Модель):** хранение и обработка данных, бизнес-логика.
- **View (Представление):** отображение интерфейса, обработка пользовательских событий.
- **Presenter (Презентер):** координация между Model и View, реализуется в основном скрипте приложения (`index.ts`).

#### Принципы архитектуры

- **Изолированность:** Каждый слой и класс отвечает только за свою зону ответственности.
- **Единственная ответственность:** Каждый компонент решает одну задачу.
- **Масштабируемость:** Добавление новых функций возможно без изменения базового кода.

#### Взаимодействие между слоями:
- Все взаимодействие между слоями происходит через события, которые обрабатываются с помощью класса EventEmitter. Это позволяет слоям быть максимально независимыми друг от друга.

**Пример взаимодействия:**
1. Пользователь нажимает кнопку «В корзину» на карточке товара (Card).
2. Card генерирует событие `product:add`.
3. Презентер (index.ts) ловит событие, обновляет AppState.
4. AppState генерирует событие `basket:changed`.
5. Basket обновляет отображение корзины.

---

### 2. Базовые классы и их предназначение

- **EventEmitter**
  Класс обеспечивает работу событийной системы.
  **Функции:**
  - Установка и снятие слушателей событий (`on`, `off`).
  - Вызов слушателей при возникновении события (`emit`).
  - Подписка на все события (`onAll`).
  - Сброс всех обработчиков (`offAll`).
  - Генерация событий через триггер (`trigger`).

- **Component**
  Абстрактный базовый класс для всех визуальных компонентов.
  **Функции:**
  - Работа с DOM: установка текста, изображений, скрытие/отображение, блокировка элементов.
  - Унифицированный метод `render` для обновления состояния компонента.

- **Api**
  Базовый класс для работы с HTTP API.
  **Функции:**
  - Выполнение GET и POST/PUT/DELETE-запросов.
  - Обработка и парсинг ответов сервера.

---

### 3. Описание компонентов, их функций и связей

#### Модели (Model)
- **AppState**
  Хранит текущее состояние приложения: каталог товаров, корзину, заказ, ошибки формы и т.д.
  **Функции:**
  - Управление каталогом и корзиной.
  - Валидация и подготовка заказа.
  - Генерация событий при изменении состояния.

- **StoreAPI**
  Класс для взаимодействия с серверным API магазина.
  **Функции:**
  - Получение списка товаров и отдельного товара.
  - Отправка заказа.

#### Представления (View)
- **Page**
  Отвечает за отображение основной страницы, каталога товаров и состояния корзины.

- **Card**
  Отображает карточку товара, обрабатывает клики по карточке и кнопке добавления/удаления из корзины.

- **Basket**
  Отображает содержимое корзины, общую сумму, кнопку оформления заказа.

- **BasketItem**
  Отображает отдельный товар в корзине, обрабатывает удаление товара.

- **Order**
  Форма для ввода адреса и выбора способа оплаты.
  **Функции:**
  - Валидация полей.
  - Генерация событий при изменении данных.

- **Contacts**
  Форма для ввода контактных данных (email, телефон).
  **Функции:**
  - Валидация полей.
  - Генерация событий при изменении данных.

- **Modal**
  Универсальный компонент для отображения модальных окон (корзина, оформление заказа, успешный заказ и т.д.).

- **Success**
  Компонент для отображения успешного оформления заказа и итоговой суммы.

#### Презентер (Presenter)
- **index.ts**
  Главный скрипт приложения, который связывает все компоненты между собой через EventEmitter.
  **Функции:**
  - Инициализация моделей, представлений и API.
  - Подписка на события и маршрутизация данных между слоями.
  - Реализация бизнес-логики переходов между экранами, обработки заказов, обновления корзины и т.д.

---

### 4. Взаимодействие компонентов

- **Данные**
  Основные типы данных описаны в `src/types/index.ts`:
  - `IProduct` — товар.
  - `IOrder`, `IOrderForm` — заказ и его форма.
  - `IProductListResponse` — ответ API со списком товаров.
  - `TFormErrors` — ошибки валидации форм.
  - и др.

- **Процессы**
  Все процессы реализованы через события:
  - Пользователь взаимодействует с интерфейсом (View), компоненты генерируют события.
  - Презентер (index.ts) слушает события, обновляет Model или View, вызывает методы API.
  - Model при изменении состояния также генерирует события для обновления View.

---

## Основные интерфейсы и типы данных

### IProduct
- Описывает товар в каталоге.
- Поля: `id`, `description`, `image`, `title`, `category`, `price`.

### IProductListResponse
- Ответ API при получении списка товаров.
- Поля: `items` (массив товаров), `total` (общее количество, опционально).

### IBasketView
- Состояние отображения корзины.
- Поля: `items` (массив DOM-элементов), `total` (сумма), `selected` (выбранные товары).

### IOrderForm
- Данные формы заказа.
- Поля: `email`, `phone`, `address`, `payment` (способ оплаты).

### IOrder
- Заказ, отправляемый на сервер.
- Наследует IOrderForm, добавляет поле `items` (массив id товаров).

### IOrderSuccess
- Ответ API при успешном заказе.
- Поля: `id` (id заказа), `total` (сумма заказа).

### IFormState
- Состояние формы.
- Поля: `valid` (валидна ли форма), `errors` (массив ошибок).

### IPage
- Состояние страницы.
- Поля: `counter` (счётчик товаров в корзине), `catalog` (массив DOM-элементов каталога), `locked` (заблокирована ли страница).

### IAppState
- Глобальное состояние приложения.
- Поля: `catalog` (товары), `basket` (id товаров в корзине), `preview` (id выбранного товара), `order` (текущий заказ), `loading` (идёт ли загрузка).

### TPaymentMethod
- Тип: `'card' | 'cash'` — способы оплаты.

### TPrice
- Тип: `number | null` — цена товара или null, если не указана.

### TFormErrors
- Тип: объект с ошибками по каждому полю формы заказа, плюс общее поле `common`.

### Category
- Перечисление (enum) для CSS-классов категорий товаров. Используется для стилизации карточек товаров в зависимости от их типа.
- Значения:
  - `'софт-скил'` — класс `card__category_soft` (мягкие навыки)
  - `'другое'` — класс `card__category_other` (прочее)
  - `'дополнительное'` — класс `card__category_additional` (дополнительные навыки)
  - `'кнопка'` — класс `card__category_button` (кнопки/действия)
  - `'хард-скил'` — класс `card__category_hard` (жёсткие навыки)

---

## События EventEmitter

### Events (enum)

- `PRODUCTS_LOADED` — каталог товаров загружен.
- `PRODUCT_SELECT` — выбран товар для просмотра.
- `PRODUCT_ADD` — товар добавлен в корзину.
- `PRODUCT_REMOVE` — товар удалён из корзины.
- `BASKET_OPEN` — открыта корзина.
- `BASKET_CHANGED` — изменилось содержимое корзины.
- `ORDER_STEP_ADDRESS` — переход к шагу ввода адреса.
- `ORDER_STEP_CONTACTS` — переход к шагу ввода контактов.
- `ORDER_SUCCESS` — заказ успешно оформлен.
- `FORM_ERRORS_CHANGE` — изменились ошибки валидации формы.
- `MODAL_OPEN` — открыто модальное окно.
- `MODAL_CLOSE` — закрыто модальное окно.

Каждое событие инициируется соответствующим действием пользователя или изменением состояния приложения и используется для связи между компонентами через EventEmitter.

---
